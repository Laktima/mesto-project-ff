(()=>{"use strict";function e(e,t){var n=document.querySelector("#".concat(e.name,"-error"));t?(e.classList.add("popup__input_error"),n.textContent=t,n.classList.add("popup__span_error")):(e.classList.remove("popup__input_error"),n.textContent="",n.classList.remove("popup__span_error"))}var t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function n(e){e.classList.remove("popup_is-animated"),e.classList.add("popup_is-opened"),document.addEventListener("keydown",r),e.addEventListener("click",o)}function o(e){e.target.classList.contains("popup_is-opened")&&c(e.target)}function r(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))}function c(e){var n,c;document.removeEventListener("keydown",r),e.removeEventListener("click",o),e.classList.remove("popup_is-opened"),e.classList.add("popup_is-animated"),n=t,(c=e).querySelectorAll(n.inputSelector).forEach((function(e){var t=c.querySelector("#".concat(e.name,"-error"));console.log(t,e),e.classList.remove("popup__input_error"),t.textContent="",t.classList.remove("popup__span_error")})),e.querySelectorAll(t.inputSelector).forEach((function(e){e.value=""}))}var u={baseUrl:"https://nomoreparties.co/v1/wff-cohort-23",headers:{authorization:"3788ab92-ec4b-445e-aebd-a01d797e384a","Content-Type":"application/json"}},a=function(e,t){(function(e){return fetch("".concat(u.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(t).then((function(){e.remove()})).catch((function(e){console.log(e)}))},i=function(e,t,n){e.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(t){e.classList.remove("card__like-button_is-active"),l(t,n)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(t){e.classList.add("card__like-button_is-active"),l(t,n)})).catch((function(e){console.log(e)}))},s=function(e,t,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);c.querySelector(".card__title").textContent=e.name;var u=c.querySelector(".card__image");u.src=e.link,u.alt=e.name;var a=c.querySelector(".card__delete-button");r!==e.owner._id?a.remove():a.addEventListener("click",(function(){return t(c,e._id)}));var i=c.querySelector(".card__like-counter"),s=c.querySelector(".card__like-button");return i.textContent=e.likes.length,s.addEventListener("click",(function(){return n(s,e._id,i)})),u.addEventListener("click",(function(){return o(e)})),e.likes.forEach((function(e){e._id===r&&s.classList.add("card__like-button_is-active")})),c};function l(e,t){t.textContent=e.likes.length}var p,d=document.querySelector(".places__list"),_=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_new-card"),m=document.querySelector(".popup_type_image"),v=document.querySelector(".popup__input_type_name"),y=document.querySelector(".popup__input_type_description"),h=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),b=document.querySelector(".profile__image"),q=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__add-button"),L=_.querySelector(".popup__close"),E=f.querySelector(".popup__close"),C=m.querySelector(".popup__close"),g=document.querySelector(".popup__input_type_url"),j=document.querySelector(".popup__input_type_card-name"),x=m.querySelector(".popup__image"),P=m.querySelector(".popup__caption"),U=document.querySelector(".avatar_edit-button"),A=document.querySelector(".popup_type_avatar-eddit"),T=document.querySelector(".popup__input_type_avatar-url"),B=A.querySelector(".popup__close"),w=A.querySelector(".popup__button"),D=_.querySelector(".popup__button"),N=f.querySelector(".popup__button"),O="",J=function(e){x.src=e.link,P.textContent=e.name,x.alt=e.name,n(m)};function M(e){h.textContent=e.name,S.textContent=e.about,b.style.backgroundImage="url(".concat(e.avatar,")")}_.querySelector(".popup__form").addEventListener("submit",(function(e){var t;e.preventDefault(),D.textContent="Сохранение...",(t={name:v.value,about:y.value},fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:t.name,about:t.about})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){M(e),c(_)})).catch((function(e){console.log(e)})).finally((function(){D.textContent="Сохранить"}))})),q.addEventListener("click",(function(e){n(_),v.value=h.textContent,y.value=S.textContent})),A.querySelector(".popup__form").addEventListener("submit",(function(e){var t;e.preventDefault(),w.textContent="Сохранение...",(t=T.value,fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){M(e),c(A)})).catch((function(e){console.log(e)})).finally((function(){w.textContent="Сохранить"}))})),U.addEventListener("click",(function(e){n(A)})),f.querySelector(".popup__form").addEventListener("submit",(function(e){var t;e.preventDefault(),N.textContent="Сохранение...",(t={name:j.value,link:g.value},fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify({name:t.name,link:t.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){d.insertBefore(s(e,a,i,J,O),d.firstChild),j.value="",g.value="",c(f)})).catch((function(e){console.log(e)})).finally((function(){N.textContent="Сохранить"}))})),k.addEventListener("click",(function(e){n(f)})),L.addEventListener("click",(function(e){c(_)})),E.addEventListener("click",(function(e){c(f)})),C.addEventListener("click",(function(e){c(m)})),B.addEventListener("click",(function(e){c(A)})),p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},document.querySelectorAll(p.formSelector).forEach((function(t){var n=t.querySelectorAll(p.inputSelector),o=t.querySelector(p.submitButtonSelector);n.forEach((function(t){t.addEventListener("input",(function(){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?e(t):e(t,t.validationMessage),function(e,t){var n=Array.from(e).some((function(e){return!e.validity.valid}));n?(t.classList.add("button-inactive"),t.setAttribute("disabled","true")):(t.classList.remove("button-inactive"),t.removeAttribute("disabled"))}(n,o)}))}))})),Promise.all([fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(u.baseUrl,"/users/me"),{headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){O=e[1]._id,console.log(e),e[0].forEach((function(e){d.append(s(e,a,i,J,O))})),M(e[1])})).catch((function(e){console.log(e)}))})();