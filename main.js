(()=>{"use strict";function e(e){e.classList.remove("popup_is-animated"),e.classList.add("popup_is-opened"),document.addEventListener("keydown",n),e.addEventListener("click",t)}function t(e){e.target.classList.contains("popup_is-opened")&&o(e.target)}function n(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}function o(e,o){document.removeEventListener("keydown",n),e.removeEventListener("click",t),e.classList.remove("popup_is-opened"),e.classList.add("popup_is-animated")}var r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-23",headers:{authorization:"3788ab92-ec4b-445e-aebd-a01d797e384a","Content-Type":"application/json"}};function c(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var u=function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then((function(e){return c(e)}))},a=function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers}).then((function(e){return c(e)}))},i=function(e,t){(function(e){return fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then((function(e){return c(e)}))})(t).then((function(){e.remove()})).catch((function(e){console.log(e)}))},l=function(e,t,n){(e.classList.contains("card__like-button_is-active")?a:u)(t).then((function(t){e.classList.toggle("card__like-button_is-active"),function(e,t){t.textContent=e.likes.length}(t,n)})).catch((function(e){return console.log(e)}))},s=function(e,t,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);c.querySelector(".card__title").textContent=e.name;var u=c.querySelector(".card__image");u.src=e.link,u.alt=e.name;var a=c.querySelector(".card__delete-button");r!==e.owner._id?a.remove():a.addEventListener("click",(function(){return t(c,e._id)}));var i=c.querySelector(".card__like-counter"),l=c.querySelector(".card__like-button");return i.textContent=e.likes.length,l.addEventListener("click",(function(){return n(l,e._id,i)})),u.addEventListener("click",(function(){return o(e)})),e.likes.forEach((function(e){e._id===r&&l.classList.add("card__like-button_is-active")})),c};function d(e,t,n){n?function(e,t,n){var o=document.querySelector("#".concat(e.name,"-error"));e.classList.add(n.inputErrorClass),o.textContent=t,o.classList.add(n.errorClass)}(e,n,t):p(e,t)}function p(e,t){var n=document.querySelector("#".concat(e.name,"-error"));e.classList.remove(t.inputErrorClass),n.textContent="",n.classList.remove(t.errorClass)}function _(e,t){t.querySelectorAll(e.inputSelector).forEach((function(t){p(t,e)}))}var f,m=document.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_new-card"),h=document.querySelector(".popup_type_image"),S=document.querySelector(".popup__input_type_name"),q=document.querySelector(".popup__input_type_description"),b=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),L=document.querySelector(".profile__image"),k=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__add-button"),g=v.querySelector(".popup__close"),x=y.querySelector(".popup__close"),A=h.querySelector(".popup__close"),U=document.querySelector(".popup__input_type_url"),T=document.querySelector(".popup__input_type_card-name"),B=h.querySelector(".popup__image"),P=h.querySelector(".popup__caption"),w=document.querySelector(".avatar_edit-button"),D=document.querySelector(".popup_type_avatar-eddit"),N=document.querySelector(".popup__input_type_avatar-url"),O=D.querySelector(".popup__close"),j=D.querySelector(".popup__button"),J=v.querySelector(".popup__button"),M=y.querySelector(".popup__button"),H="",V={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"button-inactive",inputErrorClass:"popup__input_error",errorClass:"popup__span_error"},z=function(t){B.src=t.link,P.textContent=t.name,B.alt=t.name,e(h)};function I(e){b.textContent=e.name,E.textContent=e.about,L.style.backgroundImage="url(".concat(e.avatar,")")}v.querySelector(".popup__form").addEventListener("submit",(function(e){var t;e.preventDefault(),J.textContent="Сохранение...",(t={name:S.value,about:q.value},fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:t.name,about:t.about})}).then((function(e){return c(e)}))).then((function(e){I(e),o(v)})).catch((function(e){console.log(e)})).finally((function(){J.textContent="Сохранить"}))})),k.addEventListener("click",(function(t){e(v),S.value=b.textContent,q.value=E.textContent,_(V,v)})),D.querySelector(".popup__form").addEventListener("submit",(function(e){var t;e.preventDefault(),j.textContent="Сохранение...",(t=N.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})}).then((function(e){return c(e)}))).then((function(e){I(e),o(D)})).catch((function(e){console.log(e)})).finally((function(){j.textContent="Сохранить"}))})),w.addEventListener("click",(function(t){e(D),_(V,D),D.querySelectorAll(V.inputSelector).forEach((function(e){e.value=""}))})),y.querySelector(".popup__form").addEventListener("submit",(function(e){var t;e.preventDefault(),M.textContent="Сохранение...",(t={name:T.value,link:U.value},fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:t.name,link:t.link})}).then((function(e){return c(e)}))).then((function(e){m.insertBefore(s(e,i,l,z,H),m.firstChild),T.value="",U.value="",o(y)})).catch((function(e){console.log(e)})).finally((function(){M.textContent="Сохранить"}))})),C.addEventListener("click",(function(t){e(y),_(V,y),y.querySelectorAll(V.inputSelector).forEach((function(e){e.value=""}))})),g.addEventListener("click",(function(e){o(v)})),x.addEventListener("click",(function(e){o(y)})),A.addEventListener("click",(function(e){o(h)})),O.addEventListener("click",(function(e){o(D)})),f=V,document.querySelectorAll(f.formSelector).forEach((function(e){var t=e.querySelectorAll(f.inputSelector),n=e.querySelector(f.submitButtonSelector);t.forEach((function(e){e.addEventListener("input",(function(){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?d(e,f):d(e,f,e.validationMessage),function(e,t,n){var o=Array.from(e).some((function(e){return!e.validity.valid}));o?(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","true")):(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled"))}(t,n,f)}))}))})),Promise.all([fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(e){return c(e)})),fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(e){return c(e)}))]).then((function(e){H=e[1]._id,console.log(e),e[0].forEach((function(e){m.append(s(e,i,l,z,H))})),I(e[1])})).catch((function(e){console.log(e)}))})();